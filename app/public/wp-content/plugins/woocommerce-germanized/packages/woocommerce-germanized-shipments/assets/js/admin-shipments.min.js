window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(d){window.germanized.admin.shipments={params:{},shipments:{},$wrapper:!1,needsSaving:!1,needsShipments:!0,needsReturns:!1,init:function(){var e=germanized.admin.shipments;e.params=wc_gzd_admin_shipments_params,e.$wrapper=d("#panel-order-shipments"),e.needsShipments=e.$wrapper.find("#order-shipment-add").is(":visible"),e.needsReturns=e.$wrapper.find("#order-return-shipment-add").is(":visible"),e.initShipments(),d(document).ajaxComplete(e.onAjaxComplete),d(document).on("click","#order-shipments-list .shipment-header",e.onToggleShipment).on("change","#order-shipments-list :input:visible",e.setNeedsSaving).on("click","#panel-order-shipments #order-shipment-add",e.onAddShipment).on("click","#panel-order-shipments #order-return-shipment-add",e.onAddReturn).on("click","#panel-order-shipments .remove-shipment",e.onRemoveShipment).on("click","#panel-order-shipments button#order-shipments-save",e.onSave).on("click","#panel-order-shipments .notice-dismiss",e.onRemoveNotice),d(document.body).on("wc_backbone_modal_loaded",e.backbone.init).on("wc_backbone_modal_response",e.backbone.response)},onAjaxComplete:function(e,n,i){var t=germanized.admin.shipments;if(null!=n&&i.hasOwnProperty("data")){var r,a=i.data,s=!1;try{s=JSON.parse('{"'+a.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,n){return""===e?n:decodeURIComponent(n)})}catch(e){s=!1}s&&s.hasOwnProperty("action")&&("woocommerce_save_order_items"!==(r=s.action)&&"woocommerce_remove_order_item"!==r&&"woocommerce_add_order_item"!==r&&"woocommerce_delete_refund"!==r||t.syncItemQuantities())}},syncItemQuantities:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_validate_shipment_item_quantities",active:e.getActiveShipmentId()};e.doAjax(n,e.onSyncSuccess)},onSyncSuccess:function(e){var n=germanized.admin.shipments;n.unblock(),n.initShipments(),n.initTiptip()},onSave:function(e){var n=germanized.admin.shipments;return e.preventDefault(),n.save(),!1},save:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_save_shipments",active:e.getActiveShipmentId()};e.doAjax(n,e.onSaveSuccess)},initShipment:function(e){var n=germanized.admin.shipments;n.shipments.hasOwnProperty(e)?n.shipments[e].refreshDom():n.shipments[e]=new d.GermanizedShipment(e)},onSaveSuccess:function(e){var n=germanized.admin.shipments;n.initShipments(),n.setNeedsSaving(!1),n.unblock(),n.initTiptip()},getActiveShipmentId:function(){var e=germanized.admin.shipments.$wrapper.find(".order-shipment.active");return 0<e.length&&e.data("shipment")},block:function(){germanized.admin.shipments.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){germanized.admin.shipments.$wrapper.unblock()},getData:function(e){var n=germanized.admin.shipments,i={};return e=e||{},d.each(n.$wrapper.find(":input[name]").serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),i[n.name]=d.makeArray(i[n.name]),i[n.name].push(n.value)):i[n.name]=n.value}),d.extend(i,e),i},doAjax:function(e,n,t){var r=germanized.admin.shipments,i=r.params.ajax_url,a=r.$wrapper,s=!0;a.find(".notice-wrapper").empty(),n=n||r.onAjaxSuccess,t=t||r.onAjaxError,e.hasOwnProperty("refresh_fragments")&&(s=e.refresh_fragments),e.hasOwnProperty("security")||(e.security=r.params.edit_shipments_nonce),e.hasOwnProperty("order_id")||(e.order_id=r.params.order_id),e=r.getData(e),d.ajax({type:"POST",url:i,data:e,success:function(e){var i;e.success?(active=r.getShipment(r.getActiveShipmentId()),current_packaging_id=!1,active&&(current_packaging_id=active.getShipment().find(".shipment-packaging-select").val()),s&&e.fragments&&d.each(e.fragments,function(e,n){d(e).replaceWith(n),d(e).unblock()}),n.apply(a,[e]),e.hasOwnProperty("order_needs_new_shipments")&&r.setNeedsShipments(e.order_needs_new_shipments),e.hasOwnProperty("order_needs_new_returns")&&r.setNeedsReturns(e.order_needs_new_returns),i=e.hasOwnProperty("shipments")?e.shipments:{},d.each(r.getShipments(),function(e,n){i.hasOwnProperty(e)&&(n.setIsEditable(i[e].is_editable),n.setNeedsItems(i[e].needs_items),n.setWeight(i[e].weight),n.setLength(i[e].length),n.setWidth(i[e].width),n.setHeight(i[e].height),n.setTotalWeight(i[e].total_weight),r.initShipment(e))}),(e.hasOwnProperty("needs_refresh")||e.hasOwnProperty("needs_packaging_refresh"))&&e.hasOwnProperty("shipment_id")&&(r.initShipment(e.shipment_id),e.hasOwnProperty("needs_packaging_refresh")&&(active=r.getShipment(r.getActiveShipmentId()),active&&(new_packaging_id=active.getShipment().find(".shipment-packaging-select").val(),new_packaging_id!==current_packaging_id&&r.getShipment(e.shipment_id).refreshDimensions())))):(t.apply(a,[e]),r.unblock(),e.hasOwnProperty("message")?r.addNotice(e.message,"error"):e.hasOwnProperty("messages")&&d.each(e.messages,function(e,n){r.addNotice(n,"error")}))},error:function(e){t.apply(a,[e]),r.unblock()},dataType:"json"})},onAjaxError:function(e){},onAjaxSuccess:function(e){},onRemoveNotice:function(){d(this).parents(".notice").slideUp(150,function(){d(this).remove()})},addNotice:function(e,n){germanized.admin.shipments.$wrapper.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},getParams:function(){return germanized.admin.shipments.params},onRemoveShipment:function(){var e=germanized.admin.shipments,n=d(this).parents(".order-shipment").data("shipment");return window.confirm(e.getParams().i18n_remove_shipment_notice)&&e.removeShipment(n),!1},removeShipment:function(e){var n=germanized.admin.shipments,i={action:"woocommerce_gzd_remove_shipment",shipment_id:e};n.block(),n.doAjax(i,n.onRemoveShipmentSuccess,n.onRemoveShipmentError)},onRemoveShipmentSuccess:function(e){var t=germanized.admin.shipments,n=Array.isArray(e.shipment_id)?e.shipment_id:[e.shipment_id];d.each(n,function(e,n){var i=t.$wrapper.find("#shipment-"+n);0<i.length&&(i.hasClass("active")?i.find(".shipment-content-wrapper").slideUp(300,function(){i.removeClass("active"),i.remove(),t.initShipments()}):i.remove())}),t.initShipments(),t.unblock()},onRemoveShipmentError:function(e){germanized.admin.shipments.unblock()},onAddShipment:function(){return germanized.admin.shipments.addShipment(),!1},addShipment:function(){var e=germanized.admin.shipments;e.block(),e.doAjax({action:"woocommerce_gzd_add_shipment"},e.onAddShipmentSuccess,e.onAddShipmentError)},onAddShipmentSuccess:function(e){var n=germanized.admin.shipments;0<n.$wrapper.find(".order-shipment.active").length?n.$wrapper.find(".order-shipment.active").find(".shipment-content-wrapper").slideUp(300,function(){n.$wrapper.find(".order-shipment.active").removeClass("active"),n.appendNewShipment(e),n.initShipments(),n.initTiptip(),n.unblock()}):(n.appendNewShipment(e),n.initShipments(),n.initTiptip(),n.unblock())},appendNewShipment:function(e){var n=germanized.admin.shipments;"simple"===e.new_shipment_type&&0<n.$wrapper.find(".panel-order-return-title").length?n.$wrapper.find(".panel-order-return-title").before(e.new_shipment):n.$wrapper.find("#order-shipments-list").append(e.new_shipment)},onAddShipmentError:function(e){},onAddReturn:function(){return d(this).WCBackboneModal({template:"wc-gzd-modal-add-shipment-return"}),!1},addReturn:function(e){var n=germanized.admin.shipments;n.block();var i={action:"woocommerce_gzd_add_return_shipment"};d.extend(i,e),n.doAjax(i,n.onAddReturnSuccess,n.onAddReturnError)},onAddReturnSuccess:function(e){germanized.admin.shipments.onAddShipmentSuccess(e)},onAddReturnError:function(e){germanized.admin.shipments.onAddShipmentError(e)},setNeedsSaving:function(e){var n=germanized.admin.shipments,i=n.getActiveShipmentId(),t=!!i&&n.getShipment(i).getShipment();"boolean"!=typeof e&&(e=!0),n.needsSaving=!0===e,n.needsSaving?n.$wrapper.find("#order-shipments-save").show():n.$wrapper.find("#order-shipments-save").hide(),t&&(n.needsSaving?n.disableCreateLabel(t):n.enableCreateLabel(t)),n.needsSaving?n.disableCreateLabel(t):n.enableCreateLabel(t),n.hideOrShowFooter(),d(document.body).trigger("woocommerce_gzd_shipments_needs_saving",[n.needsSaving,n.getActiveShipmentId()]),n.initTiptip()},disableCreateLabel:function(e){var n=germanized.admin.shipments,i=e.find(".create-shipment-label");0<i.length&&(i.addClass("disabled button-disabled"),i.prop("title",n.params.i18n_create_label_disabled))},enableCreateLabel:function(e){var n=germanized.admin.shipments,i=e.find(".create-shipment-label");0<i.length&&(i.removeClass("disabled button-disabled"),i.prop("title",n.params.i18n_create_label_enabled))},setNeedsShipments:function(e){var n=germanized.admin.shipments;"boolean"!=typeof e&&(e=!0),n.needsShipments=!0===e,n.needsShipments?(n.$wrapper.addClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").show()):(n.$wrapper.removeClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowReturnTitle:function(){var e=germanized.admin.shipments;0===e.$wrapper.find(".order-shipment.shipment-return").length?e.$wrapper.find(".panel-order-return-title").addClass("hide-default"):e.$wrapper.find(".panel-order-return-title").removeClass("hide-default")},setNeedsReturns:function(e){var n=germanized.admin.shipments;"boolean"!=typeof e&&(e=!0),n.needsReturns=!0===e,n.needsReturns?(n.$wrapper.addClass("needs-returns"),n.$wrapper.find("#order-return-shipment-add").show()):(n.$wrapper.removeClass("needs-returns"),n.$wrapper.find("#order-return-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowFooter:function(){var e=germanized.admin.shipments;e.needsSaving||e.needsShipments||e.needsReturns?e.$wrapper.find(".panel-footer").slideDown(300):e.$wrapper.find(".panel-footer").slideUp(300)},onToggleShipment:function(){var e=germanized.admin.shipments,n=d(this).parents(".order-shipment:first"),i=n.hasClass("active");e.closeShipments(),i||n.find("> .shipment-content-wrapper").slideDown(300,function(){n.addClass("active")})},closeShipments:function(){var e=germanized.admin.shipments;e.$wrapper.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,function(){e.$wrapper.find(".order-shipment.active").removeClass("active")})},initShipments:function(){var n=germanized.admin.shipments;n.$wrapper=d("#panel-order-shipments"),n.$wrapper.find(".order-shipment").each(function(){var e=d(this).data("shipment");n.initShipment(e)}),n.hideOrShowReturnTitle()},getShipments:function(){return germanized.admin.shipments.shipments},getShipment:function(e){var n=germanized.admin.shipments.getShipments();return!!n.hasOwnProperty(e)&&n[e]},refresh:function(e){},refreshItems:function(e){},addItem:function(){},initTiptip:function(){var e=germanized.admin.shipments;d(document.body).trigger("init_tooltips"),e.$wrapper.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),e.$wrapper.find(".create-shipment-label").tipTip({fadeIn:50,fadeOut:50,delay:200})},backbone:{onAddReturnSuccess:function(e){d("#wc-gzd-return-shipment-items").html(e.html),d(".wc-backbone-modal-content article").unblock(),d(document.body).on("change","input.wc-gzd-shipment-add-return-item-quantity",function(){var e,n=d(this),i=n.val();!n.attr("max")||(e=n.attr("max"))<i&&n.val(e)})},init:function(e,n){var i=germanized.admin.shipments;if("wc-gzd-modal-add-shipment-return"===n)return d(".wc-backbone-modal-content article").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),i.doAjax({action:"woocommerce_gzd_get_available_return_shipment_items"},i.backbone.onAddReturnSuccess),!1},response:function(e,n,i){var t=germanized.admin.shipments;"wc-gzd-modal-add-shipment-return"===n&&t.addReturn(i)}}},d(document).ready(function(){germanized.admin.shipments.init()})}(jQuery);