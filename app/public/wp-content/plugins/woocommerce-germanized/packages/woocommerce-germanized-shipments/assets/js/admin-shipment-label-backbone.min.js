window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(c){window.germanized.admin.shipment_label_backbone={params:{},init:function(){var e=germanized.admin.shipment_label_backbone;e.params=wc_gzd_admin_shipment_label_backbone_params,c(document).on("click",".germanized-create-label .show-further-services",e.onExpandServices).on("click",".germanized-create-label .show-fewer-services",e.onHideServices).on("change",".germanized-create-label input.show-if-trigger",e.onShowIf).on("click",".germanized-create-label .notice .notice-dismiss",e.onRemoveNotice).on("change",".germanized-create-label #product_id",e.onChangeProductId),c(document.body).on("wc_backbone_modal_loaded",e.backbone.init).on("wc_backbone_modal_response",e.backbone.response)},onChangeProductId:function(){germanized.admin.shipment_label_backbone.showOrHideServices(c(this).val())},showOrHideServices:function(t){c(".show-if-further-services").find("p.form-field").each(function(){var e=c(this),n=e.find(":input"),a=n.data("products-supported")?n.data("products-supported").split(","):[],i=!1;n.data("products-supported")&&(i=!0,-1!==c.inArray(t,a)&&(i=!1)),i?e.hide():e.show()})},onRemoveNotice:function(){c(this).parents(".notice").slideUp(150,function(){c(this).remove()})},onShowIf:function(){var e=c(this).parents(".germanized-create-label").find(c(this).data("show-if")),n=c(this);0<e.length&&(n.is(":checked")?e.show():e.hide(),c(document.body).trigger("wc_gzd_shipment_label_show_if"))},onExpandServices:function(){var e=c(this).parents(".germanized-create-label").find(".show-if-further-services"),n=c(this).parents(".show-services-trigger");return e.show(),n.find(".show-further-services").hide(),n.find(".show-fewer-services").show(),!1},onHideServices:function(){var e=c(this).parents(".germanized-create-label").find(".show-if-further-services"),n=c(this).parents(".show-services-trigger");return e.hide(),n.find(".show-further-services").show(),n.find(".show-fewer-services").hide(),!1},backbone:{getShipmentId:function(e){return e.replace(/^\D+/g,"")},init:function(e,n){var a,i,t,o;-1!==n.indexOf("wc-gzd-modal-create-shipment-label")&&(a=germanized.admin.shipment_label_backbone.backbone,i=germanized.admin.shipment_label_backbone,t=c(".germanized-create-label").parents(".wc-backbone-modal-content"),o={action:"woocommerce_gzd_create_shipment_label_form",shipment_id:a.getShipmentId(n),security:i.params.create_label_form_nonce},a.doAjax(o,t,a.onInitForm))},onAjaxSuccess:function(e){},onAjaxError:function(e){},doAjax:function(e,n,a,i){var t=germanized.admin.shipment_label_backbone.backbone,o=germanized.admin.shipment_label_backbone,r=n.find(".germanized-create-label");a=a||t.onAjaxSuccess,i=i||t.onAjaxError,e.hasOwnProperty("shipment_id")||(e.shipment_id=c("#wc-gzd-shipment-label-admin-shipment-id").val()),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.find(".notice-wrapper").empty(),c.ajax({type:"POST",url:o.params.ajax_url,data:e,success:function(e){e.success?(e.fragments&&c.each(e.fragments,function(e,n){c(e).replaceWith(n)}),n.unblock(),a.apply(r,[e])):(n.unblock(),i.apply(r,[e]),c.each(e.messages,function(e,n){t.addNotice(n,"error",r)}),r.animate({scrollTop:0},500))},error:function(e){},dataType:"json"})},onInitForm:function(e){var n=germanized.admin.shipment_label_backbone.backbone,a=e.shipment_id,i=c(".germanized-create-label");c(document.body).trigger("wc-enhanced-select-init"),c(document.body).trigger("wc-init-datepickers"),c(document.body).trigger("wc_gzd_shipment_label_after_init"),i.find("input.show-if-trigger").trigger("change"),i.find("#product_id").trigger("change"),i.parents(".wc-backbone-modal").on("click","#btn-ok",{shipmentId:a},n.onSubmit),i.parents(".wc-backbone-modal").on("touchstart","#btn-ok",{shipmentId:a},n.onSubmit),i.parents(".wc-backbone-modal").on("keydown",{shipmentId:a},n.onKeyDown)},getFormData:function(e){var a={};return c.each(e.serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),a[n.name]=c.makeArray(a[n.name]),a[n.name].push(n.value)):a[n.name]=n.value}),a},onSubmitSuccess:function(e){germanized.admin.shipment_label_backbone.backbone;var n=c(this).parents(".wc-backbone-modal-content"),a=e.shipment_id;n.find(".modal-close").trigger("click"),0<c("div#shipment-"+a).length&&germanized.admin.shipments.initShipment(a)},onKeyDown:function(e){var n=germanized.admin.shipment_label_backbone.backbone;13!==(e.keyCode||e.which)||e.target.tagName&&("input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase())||n.onSubmit.apply(c(this).find("button#btn-ok"),[e])},onSubmit:function(e){var n=germanized.admin.shipment_label_backbone.backbone,a=germanized.admin.shipment_label_backbone,i=e.data.shipmentId,t=c(this).parents(".wc-backbone-modal-content"),o=t.find(".germanized-create-label").find("form"),r=n.getFormData(o);r.security=a.params.create_label_nonce,r.shipment_id=i,r.action="woocommerce_gzd_create_shipment_label",n.doAjax(r,t,n.onSubmitSuccess),e.preventDefault(),e.stopPropagation()},addNotice:function(e,n,a){a.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},response:function(e,n,a){n.indexOf("wc-gzd-modal-create-shipment-label")}}},c(document).ready(function(){germanized.admin.shipment_label_backbone.init()})}(jQuery);