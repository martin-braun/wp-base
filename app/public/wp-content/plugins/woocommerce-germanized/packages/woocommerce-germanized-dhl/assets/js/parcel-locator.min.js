window.germanized=window.germanized||{},window.germanized.dhl_parcel_locator=window.germanized.dhl_parcel_locator||{},function(s,i){i.dhl_parcel_locator={params:{},parcelShops:[],wrapper:"",init:function(){var e=i.dhl_parcel_locator;e.params=wc_gzd_dhl_parcel_locator_params,e.wrapper=e.params.wrapper,s(document).on("change.dhl",e.wrapper+" #shipping_address_type",e.refreshAddressType).on("change.dhl",e.wrapper+" #shipping_address_1",e.onChangeAddress).on("change.dhl",e.wrapper+" #ship-to-different-address-checkbox",e.onChangeShipping).on("change.dhl",e.wrapper+" #shipping_country",e.refreshAvailability),s(document.body).on("updated_checkout",e.afterRefreshCheckout),e.refreshAvailability(),e.refreshAddressType()},isCheckout:function(){return i.dhl_parcel_locator.params.is_checkout},afterRefreshCheckout:function(){var a=i.dhl_parcel_locator,e={security:a.params.parcel_locator_data_nonce,action:"woocommerce_gzd_dhl_parcel_locator_refresh_shipping_data"};s.ajax({type:"POST",url:a.params.ajax_url,data:e,success:function(e){a.params.methods=e.methods,a.refreshAvailability()},error:function(e){a.refreshAvailability()},dataType:"json"})},refreshAvailability:function(){var e=i.dhl_parcel_locator,a=e.getShippingMethod(),r=e.getShippingMethodData(a);if(e.isAvailable()){var d=s(e.wrapper+" #shipping_address_type"),p=d.val();e.isCheckout()&&(d.html(""),r&&(s.each(r.address_type_options,function(e,a){d.append(s("<option/>",{value:e,text:a}))}),0<d.find('option[value="'+p+'"]').length&&d.find('option[value="'+p+'"]').prop("selected",!0),d.trigger("change"))),0<d.find("option").length?s(e.wrapper+" #shipping_address_type_field").show():s(e.wrapper+" #shipping_address_type_field").hide(),s(document.body).trigger("woocommerce_gzd_dhl_location_available_pickup_types_changed")}else s(e.wrapper+" #shipping_address_type").val("regular").trigger("change"),s(e.wrapper+" #shipping_address_type_field").hide()},onChangeShipping:function(){var e=i.dhl_parcel_locator;s(this).is(":checked")&&(e.refreshAvailability(),e.isEnabled()&&e.refreshAddressType())},onChangeAddress:function(){var e=i.dhl_parcel_locator;e.isEnabled()&&e.formatAddress()},formatAddress:function(){var e=!1,a=i.dhl_parcel_locator,r=s(a.wrapper+" #shipping_address_1"),d=r.val();0<d.length&&(s.isNumeric(d)?e=!0:a.addressIsPackstation()||a.addressIsPostOffice()||a.addressIsParcelShop()||r.val("")),e&&a.validateAddress(d),a.refreshCustomerNumberStatus()},addressIsPackstation:function(){var e=i.dhl_parcel_locator;return 0<=s(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.packstation.toLowerCase())},addressIsPostOffice:function(){var e=i.dhl_parcel_locator;return 0<=s(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.postoffice.toLowerCase())},addressIsParcelShop:function(){var e=i.dhl_parcel_locator;return 0<=s(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.parcelshop.toLowerCase())},shippingMethodSupportsPickupType:function(e,a){var r=i.dhl_parcel_locator.getShippingMethodData(e),d=!1;return r&&-1!==s.inArray(a,r.supports)&&(d=!0),d},customerNumberIsMandatory:function(){var e=i.dhl_parcel_locator;return!!e.isEnabled()&&(!!e.addressIsPackstation()||(e.addressIsParcelShop()||e.addressIsPostOffice(),!1))},refreshCustomerNumberStatus:function(){var e=i.dhl_parcel_locator,a=s(e.wrapper+" #shipping_dhl_postnumber_field");e.customerNumberIsMandatory()?(a.find("label span").length&&a.find("label span").hasClass("required")||a.find("label").append(' <span class="required">*</span>'),a.find("label span.optional").hide(),a.addClass("validate-required")):(a.find("label span.required").remove(),a.find("label span.optional").show(),a.removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field"))},validateAddress:function(e){var a=i.dhl_parcel_locator,r={action:"woocommerce_gzd_dhl_parcel_locator_validate_address",address:e,security:a.params.parcel_locator_nonce};s.ajax({type:"POST",url:a.params.ajax_url,data:r,success:function(e){e.valid?(s(a.wrapper+" #shipping_address_1").val(e.address),a.refreshCustomerNumberStatus()):s(a.wrapper+" #shipping_address_1").val("")},error:function(e){},dataType:"json"})},getShippingMethodData:function(e){var a=i.dhl_parcel_locator;return!!a.params.methods.hasOwnProperty(e)&&a.params.methods[e]},refreshAddressType:function(){var e,a=i.dhl_parcel_locator,r=s(a.wrapper+" #shipping_address_1_field"),d=s(a.wrapper+" #shipping_address_1"),p=a.getShippingMethod(),t=a.getShippingMethodData(p),l=d.val();a.isEnabled()?(t&&(d.data("label-dhl",t.street_label),d.data("placeholder-dhl",t.street_placeholder),d.data("desc-dhl",t.finder_button)),s(a.wrapper+" #shipping_dhl_postnumber_field").show(),d.data("label-dhl")&&(e=r.find("label span, label abbr"),r.find("label").html(d.data("label-dhl")+" "),r.find("label").append(e)),d.data("placeholder-dhl")&&d.attr("placeholder",d.data("placeholder-dhl")),d.data("desc-dhl")&&(r.find(".dhl-desc").remove(),r.find(".woocommerce-input-wrapper").after('<p class="desc dhl-desc">'+d.data("desc-dhl")+"</p>")),0<l.length&&a.formatAddress()):(s(a.wrapper+" #shipping_dhl_postnumber_field").hide(),d.data("label-regular")&&(e=r.find("label span, label abbr"),r.find("label").html(d.data("label-regular")+" "),r.find("label").append(e)),d.data("placeholder-regular")&&d.attr("placeholder",d.data("placeholder-regular")),r.find(".dhl-desc").remove())},isEnabled:function(){var e=i.dhl_parcel_locator;return e.isAvailable()&&"dhl"===s(e.wrapper+" #shipping_address_type").val()},getShippingMethod:function(e){var a,r="",d=e||!0;(0<s("select.shipping_method").length?r=s("select.shipping_method").val():0<s('input[name^="shipping_method"]:checked').length?r=s('input[name^="shipping_method"]:checked').val():0<s('input[name^="shipping_method"][type="hidden"]').length&&(r=s('input[name^="shipping_method"][type="hidden"]').val()),d)?void 0!==r&&0<r.length&&(a=r.split(":")).length<=1&&(r+=":0"):void 0!==r&&0<r.length&&0<(a=r.split(":")).length&&(r=a[0]);return r},pickupTypeIsAvailable:function(e){var a=i.dhl_parcel_locator,r=a.getShippingMethod(),d=!0;return a.shippingMethodSupportsPickupType(r,e)||(d=!1),d},isAvailable:function(){var e=i.dhl_parcel_locator,a=s(e.wrapper+" #shipping_country").val(),r=e.getShippingMethod(),d=e.getShippingMethodData(r),p=!0;return-1===s.inArray(a,e.params.supported_countries)&&(p=!1),e.isCheckout()&&(d&&0!==d.supports.length||(p=!1)),p}},s(document).ready(function(){i.dhl_parcel_locator.init()})}(jQuery,window.germanized);